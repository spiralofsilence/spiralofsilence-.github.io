
<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="zh-CN">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="zh-CN">
<!--<![endif]-->
<head>
	<meta charset="UTF-8" />
	<title>Garan no dou | 一只魔法师的工坊</title>
			
	
	<link rel="pingback" href="https://blog.ibireme.com/xmlrpc.php" />

		<!--[if lt IE 9]>
	<script src="https://blog.ibireme.com/wp-content/themes/Divi/js/html5.js" type="text/javascript"></script>
	<![endif]-->

	<script type="text/javascript">
		document.documentElement.className = 'js';
	</script>

	<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Garan no dou &raquo; Feed" href="https://blog.ibireme.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Garan no dou &raquo; 评论Feed" href="https://blog.ibireme.com/comments/feed/" />
<meta content="Divi v.2.5.3" name="generator"/><link rel='stylesheet' id='scap.flashblock-css'  href='https://blog.ibireme.com/wp-content/plugins/compact-wp-audio-player/css/flashblock.css?ver=4.8.7' type='text/css' media='all' />
<link rel='stylesheet' id='scap.player-css'  href='https://blog.ibireme.com/wp-content/plugins/compact-wp-audio-player/css/player.css?ver=4.8.7' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-css'  href='https://blog.ibireme.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-familiar-mynew-css'  href='https://blog.ibireme.com/wp-content/uploads/crayon-syntax-highlighter/themes/familiar-mynew/familiar-mynew.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-consolas-css'  href='https://blog.ibireme.com/wp-content/plugins/crayon-syntax-highlighter/fonts/consolas.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-easyarchives-css'  href='https://blog.ibireme.com/wp-content/plugins/wp-easyarchives/css/wp-easyarchives.css?ver=3.1.2' type='text/css' media='screen' />
<link rel='stylesheet' id='math-captcha-frontend-css'  href='https://blog.ibireme.com/wp-content/plugins/wp-math-captcha/css/frontend.css?ver=4.8.7' type='text/css' media='all' />
<link rel='stylesheet' id='wp-pagenavi-css'  href='https://blog.ibireme.com/wp-content/plugins/wp-pagenavi/pagenavi-css.css?ver=2.70' type='text/css' media='all' />
<link rel='stylesheet' id='divi-fonts-css'  href='https://fonts.googleapis.ibireme.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='et-gf-chinese-css'  href='//fonts.googleapis.ibireme.com/earlyaccess/cwtexfangsong.css' type='text/css' media='all' />
<link rel='stylesheet' id='divi-style-css'  href='https://blog.ibireme.com/wp-content/themes/Divi/style.css?ver=2.5.3' type='text/css' media='all' />
<link rel='stylesheet' id='et-shortcodes-css-css'  href='https://blog.ibireme.com/wp-content/themes/Divi/epanel/shortcodes/css/shortcodes.css?ver=3.0' type='text/css' media='all' />
<link rel='stylesheet' id='et-shortcodes-responsive-css-css'  href='https://blog.ibireme.com/wp-content/themes/Divi/epanel/shortcodes/css/shortcodes_responsive.css?ver=3.0' type='text/css' media='all' />
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/plugins/compact-wp-audio-player/js/soundmanager2-nodebug-jsmin.js?ver=4.8.7'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-includes/js/jquery/jquery.js?ver=1.12.4'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.4.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/blog.ibireme.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/plugins/simplesmileyshow/jquery.insertatcaret.js'></script>
<link rel='https://api.w.org/' href='https://blog.ibireme.com/wp-json/' />
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.ibireme.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blog.ibireme.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.8.7" />

<!-- Generated By Show-UserAgent 1.0.8 - http://zlz.im/show-useragent/ -->
<link rel="stylesheet" href="https://blog.ibireme.com/wp-content/plugins/show-useragent/show-useragent.css" type="text/css" media="screen" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />		<style id="theme-customizer-css">
													.woocommerce #respond input#submit, .woocommerce-page #respond input#submit, .woocommerce #content input.button, .woocommerce-page #content input.button, .woocommerce-message, .woocommerce-error, .woocommerce-info { background: #a9d300 !important; }
			#et_search_icon:hover, .mobile_menu_bar:before, .et-social-icon a:hover, .et_pb_sum, .et_pb_pricing li a, .et_pb_pricing_table_button, .et_overlay:before, .entry-summary p.price ins, .woocommerce div.product span.price, .woocommerce-page div.product span.price, .woocommerce #content div.product span.price, .woocommerce-page #content div.product span.price, .woocommerce div.product p.price, .woocommerce-page div.product p.price, .woocommerce #content div.product p.price, .woocommerce-page #content div.product p.price, .et_pb_member_social_links a:hover, .woocommerce .star-rating span:before, .woocommerce-page .star-rating span:before, .et_pb_widget li a:hover, .et_pb_filterable_portfolio .et_pb_portfolio_filters li a.active, .et_pb_filterable_portfolio .et_pb_portofolio_pagination ul li a.active, .et_pb_gallery .et_pb_gallery_pagination ul li a.active, .wp-pagenavi span.current, .wp-pagenavi a:hover, .nav-single a, .posted_in a { color: #a9d300; }
			.et_pb_contact_submit, .et_password_protected_form .et_submit_button, .et_pb_bg_layout_light .et_pb_newsletter_button, .comment-reply-link, .form-submit input, .et_pb_bg_layout_light .et_pb_promo_button, .et_pb_bg_layout_light .et_pb_more_button, .woocommerce a.button.alt, .woocommerce-page a.button.alt, .woocommerce button.button.alt, .woocommerce-page button.button.alt, .woocommerce input.button.alt, .woocommerce-page input.button.alt, .woocommerce #respond input#submit.alt, .woocommerce-page #respond input#submit.alt, .woocommerce #content input.button.alt, .woocommerce-page #content input.button.alt, .woocommerce a.button, .woocommerce-page a.button, .woocommerce button.button, .woocommerce-page button.button, .woocommerce input.button, .woocommerce-page input.button { color: #a9d300; }
			.footer-widget h4 { color: #a9d300; }
			.et-search-form, .nav li ul, .et_mobile_menu, .footer-widget li:before, .et_pb_pricing li:before, blockquote { border-color: #a9d300; }
			.et_pb_counter_amount, .et_pb_featured_table .et_pb_pricing_heading, .et_quote_content, .et_link_content, .et_audio_content { background-color: #a9d300; }
							.container, .et_pb_row, .et_pb_slider .et_pb_container, .et_pb_fullwidth_section .et_pb_title_container, .et_pb_fullwidth_section .et_pb_title_featured_container, .et_pb_fullwidth_header:not(.et_pb_fullscreen) .et_pb_fullwidth_header_container { max-width: 960px; }
			.et_boxed_layout #page-container, .et_fixed_nav.et_boxed_layout #page-container #top-header, .et_fixed_nav.et_boxed_layout #page-container #main-header, .et_boxed_layout #page-container .container, .et_boxed_layout #page-container .et_pb_row { max-width: 1120px; }
							a { color: #209afc; }
													#top-header, #et-secondary-nav li ul { background-color: #a9d300; }
								#top-header, #top-header a { color: rgba(0,0,0,0.7); }
												
		
					#top-menu li.current-menu-ancestor > a, #top-menu li.current-menu-item > a,
			.et_color_scheme_red #top-menu li.current-menu-ancestor > a, .et_color_scheme_red #top-menu li.current-menu-item > a,
			.et_color_scheme_pink #top-menu li.current-menu-ancestor > a, .et_color_scheme_pink #top-menu li.current-menu-item > a,
			.et_color_scheme_orange #top-menu li.current-menu-ancestor > a, .et_color_scheme_orange #top-menu li.current-menu-item > a,
			.et_color_scheme_green #top-menu li.current-menu-ancestor > a, .et_color_scheme_green #top-menu li.current-menu-item > a { color: #209afc; }
													#main-footer .footer-widget h4 { color: #a9d300; }
							.footer-widget li:before { border-color: #a9d300; }
																
		
		
		@media only screen and ( min-width: 981px ) {
																																								.et-fixed-header#top-header, .et-fixed-header#top-header #et-secondary-nav li ul { background-color: #a9d300; }
																			.et-fixed-header #top-menu li.current-menu-ancestor > a,
				.et-fixed-header #top-menu li.current-menu-item > a { color: #209afc !important; }
										.et-fixed-header#top-header a { color: rgba(0,0,0,0.7); }
			
					}
		@media only screen and ( min-width: 1200px) {
			.et_pb_row { padding: 24px 0; }
			.et_pb_section { padding: 48px 0; }
			.single.et_pb_pagebuilder_layout.et_full_width_page .et_post_meta_wrapper { padding-top: 72px; }
			.et_pb_section.et_pb_section_first { padding-top: inherit; }
			.et_pb_fullwidth_section { padding: 0; }
		}
		@media only screen and ( max-width: 980px ) {
																				}
		@media only screen and ( max-width: 767px ) {
														}
	</style>

	<style class="et_one_font_languages">h1, h2, h3, h4, h5, h6, body, input, textarea, select { font-family: 'cwTeXFangSong', serif; }</style>
	
	<style id="module-customizer-css">
			</style>

	<!-- All in one Favicon 4.5 --><link rel="icon" href="https://blog.ibireme.com/wp-content/uploads/2013/08/favicon.png" type="image/png"/>
<link rel="apple-touch-icon-precomposed" href="https://blog.ibireme.com/wp-content/uploads/2013/08/favicon2.png" />
<style type="text/css" id="et-custom-css">
h1, h2, h3, h4, h5, h6, body, input, textarea, select {
font-family: 'PingFang SC', 'Helvetica Neue', Helvetica, Arial, Verdana, 'Hiragino Sans GB', 'Noto Sans CJK SC', 'Source Han Sans CN', STHeiti, 'Microsoft YaHei', 'WenQuanYi Micro Hei', SimSun, sans-serif;
font-weight: 400;
}

body { 
	font-size: 16px;
	color: #1d1d1d;
	word-wrap:break-word;
	word-break: normal;
}

p {
	margin: 0.9em 0 0.5em;
	padding-bottom: 0.6em;
	font-size: 100%;
	vertical-align: baseline;
}

.et_pb_post h2 {
	font-weight: bold;
}

.et_pb_post .post-meta {
	14px "Classic Grotesque W01", Arial, sans-serif;
}

.et_pb_post {
	border-bottom: 1px solid #e2e2e2;
	padding-bottom: 20px;
}

.et_pb_post:last-of-type {
	border-bottom: 0px solid #e2e2e2;
}

#main-content .container {
	padding-top: 30px;
}

.et_right_sidebar #sidebar {
	padding-top: 30px;
}

.home #content-area #left-area {
	padding-top: 0px;
}

.single-post #content-area #left-area {
	padding-top: 30px;
}

.et_pb_post {
  margin-bottom: 40px;
}

.et_pb_post .entry-content, 
.project .entry-content {
  padding-top: 10px;
}

.widget_aboutmewidget .clearfix,
.et_pb_widget li {
	font-size: 93%;
}

.widgettitle {
	font-size: 120%;
}

.et_pb_scroll_top {
    bottom: 15px;
}

#top-menu li > a, 
.fullwidth-menu li > a {
	font-size: 14px;
	font-weight: 400;
}

#footer-bottom {
	padding: 5px 0 7px;
}

img.wp-smiley {
	max-height: 1.2em !important;
	height: 1.2em !important;
	width: 1.2em !important;
}

.wp-smileylink {
	max-width: 22px !important;
}

#left-area a:hover {
	text-decoration: underline;
}

#commentform textarea, 
#commentform input[type="text"] {
    font-size: 16px;
}

@media only screen and ( max-width: 767px ) {
	.et_pb_row, .container, .et_pb_container { width: 85%; }
	.et_pb_post h2, .et_pb_portfolio_item h2 { font-size: 24px; }
	.comment-body { padding: 0 0 25px 100px; }
}

#dynamic-to-top {
	display:none;
	overflow:hidden;
	width:auto;
	z-index:90;
	position:fixed;
	top:auto;
	left:auto;
	font-family:sans-serif;
	font-size:1em;
	color:#fff;
	text-decoration:none;
	text-shadow:0 1px 0 #333;
	font-weight:bold;
	padding:17px 16px;
	border:0px solid #000;
	background:#111;
	-webkit-background-origin:border;
	-moz-background-origin:border;
	-icab-background-origin:border;
	-khtml-background-origin:border;
	-o-background-origin:border;
	background-origin:border;
	-webkit-background-clip:padding-box;
	-moz-background-clip:padding-box;
	-icab-background-clip:padding-box;
	-khtml-background-clip:padding-box;
	-o-background-clip:padding-box;
	background-clip:padding-box;
	-webkit-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	-ms-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	-moz-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	-o-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	-khtml-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	-icab-box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	box-shadow:0 1px 3px rgba( 0, 0, 0, 0.4 );
	-webkit-border-radius:23px;
	-moz-border-radius:23px;
	-icab-border-radius:23px;
	-khtml-border-radius:23px;
	border-radius:23px
}
#dynamic-to-top:hover {
	background:#4d4dac;
	background:#08f -webkit-gradient( linear, 0% 0%, 0% 100%, from( rgba( 255, 255, 255, .2 ) ), to( rgba( 0, 0, 0, 0 ) ) );
	background:#08f -webkit-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	background:#08f -khtml-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	background:#08f -moz-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	background:#08f -o-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	background:#08f -ms-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	background:#08f -icab-linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	background:#08f linear-gradient( top, rgba( 255, 255, 255, .2 ), rgba( 0, 0, 0, 0 ) );
	cursor:pointer
}
#dynamic-to-top:active {
	background:#111;
	background:#111 -webkit-gradient( linear, 0% 0%, 0% 100%, from( rgba( 0, 0, 0, .3 ) ), to( rgba( 0, 0, 0, 0 ) ) );
	background:#111 -webkit-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );
	background:#111 -moz-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );
	background:#111 -khtml-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );
	background:#111 -o-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );
	background:#111 -ms-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );
	background:#111 -icab-linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) );
	background:#111 linear-gradient( top, rgba( 0, 0, 0, .1 ), rgba( 0, 0, 0, 0 ) )
}
#dynamic-to-top,#dynamic-to-top:active,#dynamic-to-top:focus,#dynamic-to-top:hover {
	outline:none
}
#dynamic-to-top span {
	display:block;
	overflow:hidden;
	width:14px;
	height:12px;
	background:url(/wp-content/plugins/dynamic-to-top/css/images/up.png )no-repeat center center
}

.entry-content table, body.et-pb-preview #main-content .container table {
    border: 1px solid #C1C1C1;
    line-height: 1.4em;

    border-collapse: separate;
}

thead {
	background-color: #F1F1F1;
}

p#copyright {
    color: #717171;
}
</style></head>
<body class="home blog et_pb_button_helper_class home-posts et_fixed_nav et_show_nav et_cover_background et_pb_gutter windows et_pb_gutters3 et_primary_nav_dropdown_animation_fade et_secondary_nav_dropdown_animation_fade et_pb_footer_columns4 et_header_style_left et_right_sidebar chrome">
	<div id="page-container">

	
		<header id="main-header" data-height-onload="66">
			<div class="container clearfix et_menu_container">
							<div class="logo_container">
					<span class="logo_helper"></span>
					<a href="https://blog.ibireme.com/">
						<img src="https://blog.ibireme.com/wp-content/uploads/2015/05/logo1.png" alt="Garan no dou" id="logo" data-height-percentage="54" />
					</a>
				</div>
				<div id="et-top-navigation" data-height="66" data-fixed-height="40">
					<nav id="top-menu-nav">
											<ul id="top-menu" class="nav">
															<li class="current_page_item"><a href="https://blog.ibireme.com/">首页</a></li>
							
							<li class="page_item page-item-34"><a href="https://blog.ibireme.com/about/">About</a></li>
<li class="page_item page-item-41502"><a href="https://blog.ibireme.com/archive/">Archive</a></li>
								<li class="cat-item cat-item-4"><a href="https://blog.ibireme.com/category/acg/" >ACG</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://blog.ibireme.com/category/other/" >其他</a>
</li>
	<li class="cat-item cat-item-10"><a href="https://blog.ibireme.com/category/chirrup/" >吐槽</a>
</li>
	<li class="cat-item cat-item-11"><a href="https://blog.ibireme.com/category/tec/" >技术</a>
<ul class='children'>
	<li class="cat-item cat-item-30"><a href="https://blog.ibireme.com/category/tec/ios-tec/" >iOS</a>
</li>
</ul>
</li>
	<li class="cat-item cat-item-7"><a href="https://blog.ibireme.com/category/daily/" >日常</a>
</li>
	<li class="cat-item cat-item-12"><a href="https://blog.ibireme.com/category/design/" >设计</a>
</li>
						</ul>
										</nav>

					
					
					<div id="et_mobile_nav_menu">
			<div class="mobile_nav closed">
				<span class="select_page">选择页面</span>
				<span class="mobile_menu_bar"></span>
			</div>
		</div>				</div> <!-- #et-top-navigation -->
			</div> <!-- .container -->
			<div class="et_search_outer">
				<div class="container et_search_form_container">
					<form role="search" method="get" class="et-search-form" action="https://blog.ibireme.com/">
					<input type="search" class="et-search-field" placeholder="搜索 &hellip;" value="" name="s" title="搜索：" />					</form>
					<span class="et_close_search_field"></span>
				</div>
			</div>
		</header> <!-- #main-header -->

		<div id="et-main-area">
<div id="main-content">
	<div class="container">
		<div id="content-area" class="clearfix">
			<div id="left-area">
		
					<article id="post-42043" class="et_pb_post post-42043 post type-post status-publish format-standard hentry category-daily">

				
															<h2><a href="https://blog.ibireme.com/2017/09/01/diary/">记事</a></h2>
					
					<p class="post-meta"> 由 <a href="https://blog.ibireme.com/author/ibireme/" title="发表人 ibireme" rel="author">ibireme</a> | 2017-09-01 | <a href="https://blog.ibireme.com/category/daily/" rel="category tag">日常</a></p><p>一年半前刚搬到这儿的时候，同伴们兴致勃勃地讨论着各种出游计划，大家建了个群，名字就叫“霓虹国出游计划委员会”。然而在接下来的日子里，有的人离职了，有的人刚入职，有的人生病了，渐渐地，这件事仿佛被忘记了，“出游计划委员会”也变成了日常聊天的地方。两个月前，有谁忽然提起了这件事，我才意识到时间已经过去那么久了。大家规划了下时间，又找人咨询了签证事宜，多番努力下，出游计划终于进行了下去。</p>
<p>初到日本第一感觉就是街道非常整洁干净，这种感觉在过去的大连也曾经能体会到一些。灰尘很少，行李箱的轮子滚了半天后，反而变得更干净了些。水分充足，路边的蕨类和苔藓都长得很好。城市的构成和运转看起来很“合理”，某种程度上，这里更能感受到“文明”的发展，至少东京是这样。我一直在提醒自己，我只能以游客的视角去探索这些城市，不懂日语，缺少有效的沟通，很多事情就很难弄明白。这个社会是怎样运作的，我看到的是否只是某种表象，这些问题还是留到之后吧。<br />
 <a href="https://blog.ibireme.com/2017/09/01/diary/#more-42043" class="more-link"><span aria-label="继续阅读记事">（更多&hellip;）</span></a></p>
				
					</article> <!-- .et_pb_post -->
			
					<article id="post-41952" class="et_pb_post post-41952 post type-post status-publish format-standard hentry category-ios-tec category-tec">

				
															<h2><a href="https://blog.ibireme.com/2016/01/16/spinlock_is_unsafe_in_ios/">不再安全的 OSSpinLock</a></h2>
					
					<p class="post-meta"> 由 <a href="https://blog.ibireme.com/author/ibireme/" title="发表人 ibireme" rel="author">ibireme</a> | 2016-01-16 | <a href="https://blog.ibireme.com/category/tec/ios-tec/" rel="category tag">iOS</a>, <a href="https://blog.ibireme.com/category/tec/" rel="category tag">技术</a></p><p class="p1"><span class="s1">昨天有位开发者在</span><span class="s2"> Github </span><span class="s1">上给我提了一个</span><span class="s2"> <a href="https://github.com/ibireme/YYModel/issues/43" target="_blank" rel="noopener">issue</a></span><span class="s1">，里面指出</span><span class="s2"> OSSpinLock </span><span class="s1">在新版</span><span class="s2"> iOS </span><span class="s1">中已经不能再保证安全了，并提供了几个相关资料的链接。我仔细查了一下相关资料，确认了这个让人不爽的 bug。</span></p>
<h2 class="p4"><span class="s2">OSSpinLock </span><span class="s1">的问题</span></h2>
<p class="p1"><span class="s3">2015-12-14 </span><span class="s2">那天，</span><a href="https://lists.swift.org/pipermail/swift-dev/Week-of-Mon-20151214/000372.html" target="_blank" rel="noopener"><span class="s3">swift-dev </span></a><span class="s2"><a href="https://lists.swift.org/pipermail/swift-dev/Week-of-Mon-20151214/000372.html" target="_blank" rel="noopener">邮件列表里</a>有人在讨论</span><span class="s3"> weak </span><span class="s2">属性的线程安全问题，其中有几位苹果工程师透露了自旋锁的 bug，对话内容大致如下：</span></p>
<p class="p5"><span class="s2">新版</span><span class="s3"> iOS </span><span class="s2">中，系统维护了</span><span class="s3"> 5 </span><span class="s2">个不同的线程优先级</span><span class="s3">/QoS: background</span><span class="s2">，</span><span class="s3">utility</span><span class="s2">，</span><span class="s3">default</span><span class="s2">，</span><span class="s3">user-initiated</span><span class="s2">，</span><span class="s3">user-interactive</span><span class="s2">。高优先级线程始终会在低优先级线程前执行，一个线程不会受到比它更低优先级线程的干扰。这种线程调度算法会产生潜在的优先级反转问题，从而破坏了</span><span class="s3"> spin lock</span><span class="s2">。</span></p>
<p class="p5"><span class="s2">具体来说，如果一个低优先级的线程获得锁并访问共享资源，这时一个高优先级的线程也尝试获得这个锁，它会处于</span><span class="s3"> spin lock </span><span class="s2">的忙等状态从而占用大量</span><span class="s3"> CPU</span><span class="s2">。此时低优先级线程无法与高优先级线程争夺</span><span class="s3"> CPU </span><span class="s2">时间，从而导致任务迟迟完不成、无法释放</span><span class="s3"> lock</span><span class="s2">。这并不只是理论上的问题，</span><span class="s3">libobjc </span><span class="s2">已经遇到了很多次这个问题了，于是苹果的工程师停用了</span><span class="s3"> OSSpinLock</span><span class="s2">。</span></p>
<p class="p5"><span class="s2">苹果工程师</span><span class="s3"> Greg Parker </span><span class="s2">提到，对于这个问题，一种解决方案是用</span><span class="s3"> truly unbounded backoff </span><span class="s2">算法，这能避免</span><span class="s3"> livelock </span><span class="s2">问题，但如果系统负载高时，它仍有可能将高优先级的线程阻塞数十秒之久；另一种方案是使用</span><span class="s3"> handoff lock </span><span class="s2">算法，这也是</span><span class="s3"> libobjc </span><span class="s2">目前正在使用的。锁的持有者会把线程</span><span class="s3"> ID </span><span class="s2">保存到锁内部，锁的等待者会临时贡献出它的优先级来避免优先级反转的问题。理论上这种模式会在比较复杂的多锁条件下产生问题，但实践上目前还一切都好。</span></p>
<p class="p5"><span class="s3">libobjc </span><span class="s2">里用的是</span><span class="s3"> Mach </span><span class="s2">内核的</span><span class="s3"> thread_switch() </span><span class="s2">然后传递了一个</span><span class="s3"> mach thread port </span><span class="s2">来避免优先级反转，另外它还用了一个私有的参数选项，所以开发者无法自己实现这个锁。另一方面，由于二进制兼容问题，</span><span class="s3">OSSpinLock </span><span class="s2">也不能有改动。</span></p>
<p class="p5"><span class="s2">最终的结论就是，除非开发者能保证访问锁的线程全部都处于同一优先级，否则</span><span class="s3"> iOS </span><span class="s2">系统中所有类型的自旋锁都不能再使用了。</span></p>
<h2 class="p6"><span class="s2">OSSpinLock 的替代方案</span></h2>
<p class="p1"><span class="s1">为了找到一个替代方案，我做了一个简单的性能测试，对比了一下几种能够替代</span><span class="s2"> OSSpinLock </span><span class="s1">锁的性能。测试是在</span><span class="s2"> iPhone6</span><span class="s1">、</span><span class="s2">iOS9 </span><span class="s1">上跑的，代码在<a href="https://github.com/ibireme/tmp/blob/master/iOSLockBenckmark/iOSLockBenckmark/ViewController.m" target="_blank" rel="noopener">这里</a></span><span class="s1">。这里只是测试了单线程的情况</span><span class="s1">，不能反映多线程下的实际性能，所以这个结果只能当作一个定性分析。</span></p>
<p class="p1"><a href="https://blog.ibireme.com/wp-content/uploads/2016/01/lock_benchmark.png"><img class="alignnone wp-image-41953" src="https://blog.ibireme.com/wp-content/uploads/2016/01/lock_benchmark.png" alt="lock_benchmark" width="530" height="342" /></a></p>
<p class="p1"><span class="s1">可以看到除了</span><span class="s2"> OSSpinLock </span><span class="s1">外，</span><span class="s2">dispatch_semaphore </span><span class="s1">和</span><span class="s2"> pthread_mutex </span><span class="s1">性能是最高的。有<a href="http://mjtsai.com/blog/2015/12/16/osspinlock-is-unsafe/" target="_blank" rel="noopener">消息</a></span><span class="s1">称，苹果在新系统中已经优化了</span><span class="s2"> pthread_mutex </span><span class="s1">的性能，所以它看上去和</span><span class="s2"> OSSpinLock </span><span class="s1">差距并没有那么大了。</span></p>
<h2 class="p1">社区反应</h2>
<p class="p1"><strong><span class="s1" style="color: #99cc00;">苹果</span></strong></p>
<p class="p1"><span class="s1">查看 CoreFoundation 的源码能够发现，苹果至少在</span><span class="s2"> 2014 </span><span class="s1">年就发现了这个问题，并把</span><span class="s2"> CoreFoundation </span><span class="s1">中的</span><span class="s2"> spinlock </span><span class="s1">替换成了</span><span class="s2"> pthread_mutex</span><span class="s1">，具体变化可以查看这两个文件：<a href="http://www.opensource.apple.com/source/CF/CF-855.17/CFInternal.h" target="_blank" rel="noopener">CFInternal.h(855.17)</a>、<a href="http://www.opensource.apple.com/source/CF/CF-1151.16/CFInternal.h" target="_blank" rel="noopener">CFInternal.h(1151.16)</a>。</span><span class="s2">苹果自己发现问题后，并没有及时更新</span><span class="s3"> OSSpinLock </span><span class="s2">的文档，也没有告知开发者，这有些让人失望。</span></p>
<p>在 iOS 10/macOS 10.12 发布时，苹果提供了新的 os_unfair_lock 作为 OSSpinLock 的替代，并且将 OSSpinLock 标记为了 Deprecated。</p>
<p class="p1"><span class="s2" style="color: #99cc00;">Google</span></p>
<p class="p1"><span class="s2">google/</span><span class="s2">protobuf </span><span class="s1">内部的</span><span class="s2"> spinlock 被全部</span><span class="s1">替换为</span><span class="s2"> dispatch_semaphore</span><span class="s1">，详情可以看这个提交：<a href="https://github.com/google/protobuf/pull/1060" target="_blank" rel="noopener">https://github.com/google/protobuf/pull/1060</a>。用 dispatch_semaphore 而不用 pthread_mutex 应该是出于性能考虑。</span></p>
<p class="p1">
<h2 class="p1">相关链接</h2>
<p><a href="https://lists.swift.org/pipermail/swift-dev/Week-of-Mon-20151214/000344.html" target="_blank" rel="noopener">https://lists.swift.org/pipermail/swift-dev/Week-of-Mon-20151214/000344.html</a></p>
<p><a href="http://mjtsai.com/blog/2015/12/16/osspinlock-is-unsafe/" target="_blank" rel="noopener">http://mjtsai.com/blog/2015/12/16/osspinlock-is-unsafe/</a></p>
<p><a href="http://engineering.postmates.com/Spinlocks-Considered-Harmful-On-iOS/" target="_blank" rel="noopener">http://engineering.postmates.com/Spinlocks-Considered-Harmful-On-iOS/</a></p>
<p><a href="https://twitter.com/steipete/status/676851647042203648" target="_blank" rel="noopener">https://twitter.com/steipete/status/676851647042203648</a></p>
				
					</article> <!-- .et_pb_post -->
			
					<article id="post-41945" class="et_pb_post post-41945 post type-post status-publish format-standard hentry category-chirrup">

				
															<h2><a href="https://blog.ibireme.com/2015/12/17/move/">搬家前</a></h2>
					
					<p class="post-meta"> 由 <a href="https://blog.ibireme.com/author/ibireme/" title="发表人 ibireme" rel="author">ibireme</a> | 2015-12-17 | <a href="https://blog.ibireme.com/category/chirrup/" rel="category tag">吐槽</a></p><p>晚上回到家，发现家里停电了。打开电脑连不上网，手机流量又不多，只好写点吐槽了。</p>
<p>又快要到新的一年了呢， 回头看看年初那篇吐槽文章中的年度计划，大半是没实现（摊手）。MIDI App 项目停滞了，数码绘没有搞，电钢没怎么练，空闲时间大都花在写代码上了（笑）。新的一年可能会有些新的计划了，我可能需要更好的时间管理，毕竟精力有限。</p>
<p>来北京后，我和小伙伴们总因为这样那样的原因，每年换一套房子，今年也不例外。如果一切顺利的话，在圣诞节过后的那一周，我们就会搬进更大的新房子了。在这里最舍不得的，可能就是这个书房了吧。不知道新房子还能不能有这么大的书架。</p>
<p><a href="https://blog.ibireme.com/wp-content/uploads/2015/12/IMG_2604_.jpg"><img class="alignnone size-full wp-image-41946" src="https://blog.ibireme.com/wp-content/uploads/2015/12/IMG_2604_.jpg" alt="IMG_2604_" width="3264" height="2448" /></a></p>
<p>最后，整理一下今年买到的纸质书吧：</p>
<p> <a href="https://blog.ibireme.com/2015/12/17/move/#more-41945" class="more-link"><span aria-label="继续阅读搬家前">（更多&hellip;）</span></a></p>
				
					</article> <!-- .et_pb_post -->
			
					<article id="post-41893" class="et_pb_post post-41893 post type-post status-publish format-standard hentry category-ios-tec category-tec">

				
															<h2><a href="https://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/">iOS 保持界面流畅的技巧</a></h2>
					
					<p class="post-meta"> 由 <a href="https://blog.ibireme.com/author/ibireme/" title="发表人 ibireme" rel="author">ibireme</a> | 2015-11-12 | <a href="https://blog.ibireme.com/category/tec/ios-tec/" rel="category tag">iOS</a>, <a href="https://blog.ibireme.com/category/tec/" rel="category tag">技术</a></p><p class="none">这篇文章会非常详细的分析 iOS 界面构建中的各种性能问题以及对应的解决思路，同时给出一个开源的微博列表实现，通过实际的代码展示如何构建流畅的交互。</p>
<p>Index<br />
<a href="#1">演示项目</a><br />
<a href="#2">屏幕显示图像的原理</a><br />
<a href="#3">卡顿产生的原因和解决方案</a><br />
<a style="padding-left: 30px;" href="#31">CPU 资源消耗原因和解决方案</a><br />
<a style="padding-left: 30px;" href="#32"> GPU 资源消耗原因和解决方案</a><br />
<a href="#4"> AsyncDisplayKit</a><br />
<a style="padding-left: 30px;" href="#41">ASDK 的由来</a><br />
<a style="padding-left: 30px;" href="#42">ASDK 的资料</a><br />
<a style="padding-left: 30px;" href="#43">ASDK 的基本原理</a><br />
<a style="padding-left: 30px;" href="#44">ASDK 的图层预合成</a><br />
<a style="padding-left: 30px;" href="#45">ASDK 异步并发操作</a><br />
<a style="padding-left: 30px;" href="#46">Runloop 任务分发</a><br />
<a href="#5">微博 Demo 性能优化技巧</a><br />
<a style="padding-left: 30px;" href="#51">预排版</a><br />
<a style="padding-left: 30px;" href="#52">预渲染</a><br />
<a style="padding-left: 30px;" href="#53">异步绘制</a><br />
<a style="padding-left: 30px;" href="#54">全局并发控制</a><br />
<a style="padding-left: 30px;" href="#55">更高效的异步图片加载</a><br />
<a style="padding-left: 30px;" href="#56">其他可以改进的地方</a><br />
<a href="#6">如何评测界面的流畅度</a></p>
<p><a name="1"></a></p>
<h2 class="none"><strong>演示项目</strong></h2>
<p class="none">在开始技术讨论前，你可以先下载我写的 Demo 跑到真机上体验一下：<a href="https://github.com/ibireme/YYKit" target="_blank">https://github.com/ibireme/YYKit</a>。 Demo 里包含一个微博的 Feed 列表、发布视图，还包含一个 Twitter 的 Feed 列表。为了公平起见，所有界面和交互我都从官方应用原封不动的抄了过来，数据也都是从官方应用抓取的。你也可以自己抓取数据替换掉 Demo 中的数据，方便进行对比。尽管官方应用背后的功能更多更为复杂，但不至于会带来太大的交互性能差异。</p>
<p class="none"><a href="https://blog.ibireme.com/wp-content/uploads/2015/11/weibo.png"><img class="alignnone wp-image-41926" src="https://blog.ibireme.com/wp-content/uploads/2015/11/weibo.png" alt="weibo" width="230" height="409" /></a><a href="https://blog.ibireme.com/wp-content/uploads/2015/11/weibo_compose.png"><img class="alignnone wp-image-41927" src="https://blog.ibireme.com/wp-content/uploads/2015/11/weibo_compose.png" alt="weibo_compose" width="230" height="409" /></a><a href="https://blog.ibireme.com/wp-content/uploads/2015/11/twitter.png"><img class="alignnone wp-image-41928" src="https://blog.ibireme.com/wp-content/uploads/2015/11/twitter.png" alt="twitter" width="230" height="409" /></a></p>
<p class="none">这个 Demo 最低可以运行在 iOS 6 上，所以你可以把它跑到老设备上体验一下。在我的测试中，即使在 iPhone 4S 或者 iPad 3 上，Demo 列表在快速滑动时仍然能保持 50~60 FPS 的流畅交互，而其他诸如微博、朋友圈等应用的列表视图在滑动时已经有很严重的卡顿了。</p>
<p class="none">微博的 Demo 有大约四千行代码，Twitter 的只有两千行左右代码，第三方库只用到了 YYKit，文件数量比较少，方便查看。好了，下面是正文。</p>
<p> <a href="https://blog.ibireme.com/2015/11/12/smooth_user_interfaces_for_ios/#more-41893" class="more-link"><span aria-label="继续阅读iOS 保持界面流畅的技巧">（更多&hellip;）</span></a></p>
				
					</article> <!-- .et_pb_post -->
			
					<article id="post-41871" class="et_pb_post post-41871 post type-post status-publish format-standard hentry category-ios-tec category-tec">

				
															<h2><a href="https://blog.ibireme.com/2015/11/02/ios_image_tips/">iOS 处理图片的一些小 Tip</a></h2>
					
					<p class="post-meta"> 由 <a href="https://blog.ibireme.com/author/ibireme/" title="发表人 ibireme" rel="author">ibireme</a> | 2015-11-02 | <a href="https://blog.ibireme.com/category/tec/ios-tec/" rel="category tag">iOS</a>, <a href="https://blog.ibireme.com/category/tec/" rel="category tag">技术</a></p><p class="none"><span style="color: #a2c700;"><strong>如何把 GIF 动图保存到相册？</strong></span></p>
<p class="none">iOS 的相册是支持保存 GIF 和 APNG 动图的，只是不能直接播放。用 [ALAssetsLibrary writeImageDataToSavedPhotosAlbum:metadata:completionBlock] 可以直接把 APNG、GIF 的数据写入相册。如果图省事直接用 UIImageWriteToSavedPhotosAlbum() 写相册，那么图像会被强制转码为 PNG。</p>
<p class="none"><span style="color: #a2c700;"><strong>将 UIImage 保存到磁盘，用什么方式最好？</strong></span></p>
<p class="none">目前来说，保存 UIImage 有三种方式：1.直接用 NSKeyedArchiver 把 UIImage 序列化保存，2.用 UIImagePNGRepresentation() 先把图片转为 PNG 保存，3.用 UIImageJPEGRepresentation() 把图片压缩成 JPEG 保存。</p>
<p class="none">实际上，NSKeyedArchiver 是调用了 UIImagePNGRepresentation 进行序列化的，用它来保存图片是消耗最大的。苹果对 JPEG 有硬编码和硬解码，保存成 JPEG 会大大缩减编码解码时间，也能减小文件体积。所以如果图片不包含透明像素时，UIImageJPEGRepresentation(0.9) 是最佳的图片保存方式，其次是 UIImagePNGRepresentation()。</p>
<p class="none"><span style="color: #a2c700;"><strong>UIImage 缓存是怎么回事？</strong></span></p>
<p class="none">通过 imageNamed 创建 UIImage 时，系统实际上只是在 Bundle 内查找到文件名，然后把这个文件名放到 UIImage 里返回，并没有进行实际的文件读取和解码。当 UIImage 第一次显示到屏幕上时，其内部的解码方法才会被调用，同时解码结果会保存到一个全局缓存去。据我观察，在图片解码后，App 第一次退到后台和收到内存警告时，该图片的缓存才会被清空，其他情况下缓存会一直存在。</p>
<p class="none"><span style="color: #a2c700;"><strong>我要是用 imageWithData 能不能避免缓存呢？</strong></span></p>
<p class="none">不能。通过数据创建 UIImage 时，UIImage 底层是调用 ImageIO 的 CGImageSourceCreateWithData() 方法。该方法有个参数叫 ShouldCache，在 64 位的设备上，这个参数是默认开启的。这个图片也是同样在第一次显示到屏幕时才会被解码，随后解码数据被缓存到 CGImage 内部。与 imageNamed 创建的图片不同，如果这个图片被释放掉，其内部的解码数据也会被立刻释放。</p>
<p class="none"><span style="color: #a2c700;"><strong>怎么能避免缓存呢？</strong></span></p>
<p class="none">1. 手动调用 CGImageSourceCreateWithData() 来创建图片，并把 ShouldCache 和 ShouldCacheImmediately 关掉。这么做会导致每次图片显示到屏幕时，解码方法都会被调用，造成很大的 CPU 占用。<br />
2. 把图片用 CGContextDrawImage() 绘制到画布上，然后把画布的数据取出来当作图片。这也是常见的网络图片库的做法。</p>
<p class="none"><span style="color: #a2c700;"><strong>我能直接取到图片解码后的数据，而不是通过画布取到吗？</strong></span></p>
<p class="none">1.CGImageSourceCreateWithData(data) 创建 ImageSource。<br />
2.CGImageSourceCreateImageAtIndex(source) 创建一个未解码的 CGImage。<br />
3.CGImageGetDataProvider(image) 获取这个图片的数据源。<br />
4.CGDataProviderCopyData(provider) 从数据源获取直接解码的数据。<br />
ImageIO 解码发生在最后一步，这样获得的数据是没有经过颜色类型转换的原生数据（比如灰度图像）。</p>
<p class="none"><span style="color: #a2c700;"><strong>如何判断一个文件的图片类型？</strong></span></p>
<p class="none">通过读取文件或数据的头几个字节然后和对应图片格式标准进行比对。我在<a href="https://github.com/ibireme/YYImage/blob/master/YYImage/YYImageCoder.m#L1066-L1141" target="_blank">这里</a>写了一个简单的函数，能很快速的判断图片格式。</p>
<p class="none"><span style="color: #a2c700;"><strong>怎样像浏览器那样边下载边显示图片？</strong></span></p>
<p class="none">首先，图片本身有 3 种常见的编码方式：</p>
<p class="none"><a href="https://blog.ibireme.com/wp-content/uploads/2015/11/image_baseline.gif"><img class="alignnone wp-image-41872" src="https://blog.ibireme.com/wp-content/uploads/2015/11/image_baseline.gif" alt="image_baseline" width="160" height="159" /></a> <a href="https://blog.ibireme.com/wp-content/uploads/2015/11/image_interlaced.gif"><img class="alignnone wp-image-41873" src="https://blog.ibireme.com/wp-content/uploads/2015/11/image_interlaced.gif" alt="image_interlaced" width="160" height="160" /></a> <a href="https://blog.ibireme.com/wp-content/uploads/2015/11/image_progressive.gif"><img class="alignnone wp-image-41874" src="https://blog.ibireme.com/wp-content/uploads/2015/11/image_progressive.gif" alt="image_progressive" width="160" height="159" /></a></p>
<p>第一种是 baseline，即逐行扫描。默认情况下，JPEG、PNG、GIF 都是这种保存方式。<br />
第二种是 interlaced，即隔行扫描。PNG 和 GIF 在保存时可以选择这种格式。<br />
第三种是 progressive，即渐进式。JPEG 在保存时可以选择这种方式。<br />
在下载图片时，首先用 CGImageSourceCreateIncremental(NULL) 创建一个空的图片源，随后在获得新数据时调用<br />
CGImageSourceUpdateData(data, false) 来更新图片源，最后在用 CGImageSourceCreateImageAtIndex() 创建图片来显示。</p>
<p class="none">你可以用 <a href="https://github.com/pinterest/PINRemoteImage" target="_blank">PINRemoteImage</a> 或者我写的 <a href="https://github.com/ibireme/YYWebImage" target="_blank">YYWebImage</a> 来实现这个效果。SDWebImage 并没有用 Incremental 方式解码，所以显示效果很差。</p>
				
					</article> <!-- .et_pb_post -->
			
					<article id="post-41834" class="et_pb_post post-41834 post type-post status-publish format-standard hentry category-ios-tec category-tec">

				
															<h2><a href="https://blog.ibireme.com/2015/11/02/mobile_image_benchmark/">移动端图片格式调研</a></h2>
					
					<p class="post-meta"> 由 <a href="https://blog.ibireme.com/author/ibireme/" title="发表人 ibireme" rel="author">ibireme</a> | 2015-11-02 | <a href="https://blog.ibireme.com/category/tec/ios-tec/" rel="category tag">iOS</a>, <a href="https://blog.ibireme.com/category/tec/" rel="category tag">技术</a></p><p class="none">图片通常是移动端流量耗费最多的部分，并且占据着重要的视觉空间。合理的图片格式选用和优化可以为你节省带宽、提升视觉效果。在这篇文章里我会分析一下目前主流和新兴的几种图片格式的特点、性能分析、参数调优，以及相关开源库的选择。</p>
<p>Index<br />
<a href="#intro">几种图片格式简介</a><br />
<a href="#mobile">移动端图片类型的支持情况</a><br />
<a href="#still">静态图片的编码与解码</a><br />
<a style="padding-left: 30px;" href="#still_jpeg">JPEG</a><br />
<a style="padding-left: 30px;" href="#still_png">PNG</a><br />
<a style="padding-left: 30px;" href="#still_webp">WebP</a><br />
<a style="padding-left: 30px;" href="#still_bpg">BPG</a><br />
<a href="#ani">动态图片的编码与解码</a><br />
<a style="padding-left: 30px;" href="#ani_gif">GIF</a><br />
<a style="padding-left: 30px;" href="#ani_apng">APNG</a><br />
<a style="padding-left: 30px;" href="#ani_webp">WebP</a><br />
<a style="padding-left: 30px;" href="#ani_bpg">BPG</a><br />
<a style="padding-left: 30px;" href="#ani_bench">动图性能对比</a></p>
<p> <a href="https://blog.ibireme.com/2015/11/02/mobile_image_benchmark/#more-41834" class="more-link"><span aria-label="继续阅读移动端图片格式调研">（更多&hellip;）</span></a></p>
				
					</article> <!-- .et_pb_post -->
			
					<article id="post-41822" class="et_pb_post post-41822 post type-post status-publish format-standard hentry category-ios-tec category-tec">

				
															<h2><a href="https://blog.ibireme.com/2015/10/26/yycache/">YYCache 设计思路</a></h2>
					
					<p class="post-meta"> 由 <a href="https://blog.ibireme.com/author/ibireme/" title="发表人 ibireme" rel="author">ibireme</a> | 2015-10-26 | <a href="https://blog.ibireme.com/category/tec/ios-tec/" rel="category tag">iOS</a>, <a href="https://blog.ibireme.com/category/tec/" rel="category tag">技术</a></p><p class="p2"><a href="https://blog.ibireme.com/wp-content/uploads/2015/10/cache_all_the_things.jpg"><img class="wp-image-41823 size-full alignnone" src="https://blog.ibireme.com/wp-content/uploads/2015/10/cache_all_the_things.jpg" alt="cache_all_the_things" width="400" height="300" /></a></p>
<p class="p2"><span class="s1">iOS 开发中总会用到各种缓存，最初我是用的一些开源的缓存库，但到总觉得缺少某些功能，或某些 API 设计的不够好用。YYCache (<a href="https://github.com/ibireme/YYCache" target="_blank">https://github.com/ibireme/YYCache</a>) 是我新造的一个轮子，下面说一下这个轮子的设计思路。</span></p>
<h2 class="p2"><span class="s1">内存缓存</span></h2>
<p class="p2"><span class="s1">通常一个缓存是由内存缓存和磁盘缓存组成，内存缓存提供容量小但高速的存取功能，磁盘缓存提供大容量但低速的持久化存储。相对于磁盘缓存来说，内存缓存的设计要更简单些，下面是我调查的一些常见的内存缓存。</span></p>
<p class="p2"><span class="s1">NSCache 是苹果提供的一个简单的内存缓存，它有着和 NSDictionary 类似的 API，不同点是它是线程安全的，并且不会 retain key。我在测试时发现了它的几个特点：NSCache 底层并没有用 NSDictionary 等已有的类，而是直接调用了 libcache.dylib，其中线程安全是由 pthread_mutex 完成的。另外，它的性能和 key 的相似度有关，如果有大量相似的 key (比如 </span><span class="s2">&#8220;1&#8221;</span><span class="s1">, </span><span class="s2">&#8220;2&#8221;</span><span class="s1">, </span><span class="s2">&#8220;3&#8221;</span><span class="s1">, &#8230;)，NSCache 的存取性能会下降得非常厉害，大量的时间被消耗在 CFStringEqual() 上，不知这是不是 NSCache 本身设计的缺陷。</span></p>
<p class="p2"><span class="s1"><a href="https://github.com/tumblr/TMCache" target="_blank">TMMemoryCache</a> 是 <a href="https://github.com/tumblr/TMCache" target="_blank">TMCache</a> 的内存缓存实现，最初由 Tumblr 开发，但现在已经不再维护了。TMMemoryCache 实现有很多 NSCache 并没有提供的功能，比如数量限制、总容量限制、存活时间限制、内存警告或应用退到后台时清空缓存等。TMMemoryCache 在设计时，主要目标是线程安全，它把所有读写操作都放到了同一个 concurrent queue 中，然后用 dispatch_barrier_async 来保证任务能顺序执行。它错误的用了大量异步 block 回调来实现存取功能，以至于产生了很大的性能和死锁问题。</span></p>
<p class="p2"><span class="s1"><a href="https://github.com/pinterest/PINCache" target="_blank">PINMemoryCache</a> 是 Tumblr 宣布不在维护 TMCache 后，由 Pinterest 维护和改进的一个内存缓存。它的功能和接口基本和 TMMemoryCache 一样，但修复了性能和死锁的问题。它同样也用 dispatch_semaphore 来保证线程安全，但去掉了dispatch_barrier_async，避免了线程切换带来的巨大开销，也避免了可能的死锁。</span></p>
<p class="p2"><span class="s1"><a href="https://github.com/ibireme/YYCache" target="_blank">YYMemoryCache</a> 是我开发的一个内存缓存，相对于 PINMemoryCache 来说，我去掉了异步访问的接口，尽量优化了同步访问的性能，用 OSSpinLock 来保证线程安全。另外，缓存内部用双向链表和 NSDictionary 实现了 LRU 淘汰算法，相对于上面几个算是一点进步吧。</span></p>
<p class="p2"><span class="s1">下面的单线程的 Memory Cache 性能基准测试：</span></p>
<p class="p2"><a href="https://blog.ibireme.com/wp-content/uploads/2015/10/memory_cache_bench_result.png"><img class="wp-image-41824 alignnone" src="https://blog.ibireme.com/wp-content/uploads/2015/10/memory_cache_bench_result.png" alt="memory_cache_bench_result" width="728" height="500" /></a></p>
<p class="p2"><span class="s1">可以看到 YYMemoryCache 的性能不错，仅次于 NSDictionary + OSSpinLock；<br />
NSCache 的写入性能稍差，读取性能不错；<br />
PINMemoryCache 的读写性能也还可以，但读取速度差于 NSCache；<br />
TMMemoryCache 性能太差以至于图上都看不出来了。</span></p>
<h2 class="p2"><span class="s1">磁盘缓存</span></h2>
<p class="p2"><span class="s1">为了设计一个比较好的磁盘缓存，我调查了大量的开源库，包括 TMDiskCache、PINDiskCache、SDWebImage、FastImageCache 等，也调查了一些闭源的实现，包括 NSURLCache、Facebook 的 FBDiskCache 等。他们的实现技术大致分为三类：基于文件读写、基于 mmap 文件内存映射、基于数据库。</span></p>
<p class="p2"><span class="s1">TMDiskCache, PINDiskCache, SDWebImage 等缓存，都是基于文件系统的，即一个 Value 对应一个文件，通过文件读写来缓存数据。他们的实现都比较简单，性能也都相近，缺点也是同样的：不方便扩展、没有元数据、难以实现较好的淘汰算法、数据统计缓慢。</span></p>
<p class="p2"><span class="s1">FastImageCache 采用的是 mmap 将文件映射到内存。用过 MongoDB 的人应该很熟悉 mmap 的缺陷：热数据的文件不要超过物理内存大小，不然 mmap 会导致内存交换严重降低性能；另外内存中的数据是定时 flush 到文件的，如果数据还未同步时程序挂掉，就会导致数据错误。抛开这些缺陷来说，mmap 性能非常高。</span></p>
<p class="p3"><span class="s3">NSURLCache、FBDiskCache 都是基于 SQLite 数据库的。基于数据库的缓存可以很好的支持元数据、扩展方便、数据统计速度快，也很容易实现 LRU 或其他淘汰算法，唯一不确定的就是数据库读写的性能，为此我评测了一下 SQLite 在真机上的表现。iPhone </span><span class="s4">6</span> <span class="s4">64</span><span class="s3">G 下，SQLite 写入性能比直接写文件要高，但读取性能取决于数据大小：当单条数据小于 </span><span class="s4">20</span><span class="s3">K 时，数据越小 SQLite 读取性能越高；单条数据大于 </span><span class="s4">20</span><span class="s3">K 时，直接写为文件速度会更快一些。这和 <a href="http://www.sqlite.org/intern-v-extern-blob.html" target="_blank">SQLite 官网的描述</a>基本一致。</span><span class="s1">另外，直接从官网下载最新的 SQLite 源码编译，会比 iOS 系统自带的 sqlite3.dylib 性能要高很多。基于 SQLite 的这种表现，磁盘缓存最好是把 SQLite 和文件存储结合起来：key-value 元数据保存在 SQLite 中，而 value 数据则根据大小不同选择 SQLite 或文件存储。NSURLCache 选定的数据大小的阈值是 16K；FBDiskCache 则把所有 value 数据都保存成了文件。</span></p>
<p class="p2"><span class="s1">我的 YYDiskCache 也是采用的 SQLite 配合文件的存储方式，在 iPhone </span><span class="s4">6</span> <span class="s4">64</span><span class="s1">G 上的性能基准测试结果见下图。在存取小数据 (NSNumber) 时，YYDiskCache 的性能远远高出基于文件存储的库；而较大数据的存取性能则比较接近了。但得益于 SQLite 存储的元数据，YYDiskCache 实现了 LRU 淘汰算法、更快的数据统计，更多的容量控制选项。</span></p>
<p class="p2"><a href="https://blog.ibireme.com/wp-content/uploads/2015/10/disk_cache_bench_result.png"><img class="alignnone wp-image-41825" src="https://blog.ibireme.com/wp-content/uploads/2015/10/disk_cache_bench_result.png" alt="disk_cache_bench_result" width="728" height="397" /></a></p>
<h2 class="p2"><span class="s1">备注：</span></h2>
<p class="p2"><strong><span class="s1">关于锁：</span></strong></p>
<p class="p2"><span class="s1">OSSpinLock 自旋锁，性能最高的锁。原理很简单，就是一直 </span><span class="s5">do</span> <span class="s5">while</span><span class="s1"> 忙等。它的缺点是当等待时会消耗大量 CPU 资源，所以它不适用于较长时间的任务。对于内存缓存的存取来说，它非常合适。</span></p>
<p class="p2"><span class="s1">dispatch_semaphore 是信号量，但当信号总量设为 </span><span class="s4">1</span><span class="s1"> 时也可以当作锁来。在没有等待情况出现时，它的性能比 pthread_mutex 还要高，但一旦有等待情况出现时，性能就会下降许多。相对于 OSSpinLock 来说，它的优势在于等待时不会消耗 CPU 资源。对磁盘缓存来说，它比较合适。</span></p>
<p class="p2"><strong><span class="s1">关于 Realm：</span></strong></p>
<p class="p2">Realm 是一个比较新的数据库，针对移动应用所设计。它的 API 对于开发者来说非常友好，比 SQLite、CoreData 要易用很多，但相对的坑也有不少。我在测试 SQLite 性能时，也尝试对它做了些简单的评测。我从 Realm 官网下载了它提供的 benchmark 项目，更新 SQLite 到官网最新的版本，并启用了 SQLite 的 sqlite3_stmt 缓存。我的评测结果显示 Realm 在写入性能上差于 SQLite，读取小数据时也差 SQLite 不少，读取较大数据时 Realm 有很大的优势。当然这只是我个人的评测，可能并不能反映真实项目中具体的使用情况。我想看看它的实现原理，但发现 Realm 的核心 realm-core 是闭源的（评论里 Realm 员工提到目前有在 Apache 2.0 授权下的开源计划），能知道的是 Realm 应该用 了 mmap 把文件映射到内存，所以才在较大数据读取时获得很高的性能。另外我注意到添加了 Realm 的 App 会在启动时向某几个 IP 发送数据，评论中有 Realm 员工反馈这是发送匿名统计数据，并且只针对模拟器和 Debug 模式。这部分代码目前是开源的，并且可以通过环境变量 REALM_DISABLE_ANALYTICS 来关闭，如果有使用 Realm 的可以注意一下。</p>
				
					</article> <!-- .et_pb_post -->
			
					<article id="post-41804" class="et_pb_post post-41804 post type-post status-publish format-standard hentry category-ios-tec category-tec">

				
															<h2><a href="https://blog.ibireme.com/2015/10/23/ios_model_framework_benchmark/">iOS JSON 模型转换库评测</a></h2>
					
					<p class="post-meta"> 由 <a href="https://blog.ibireme.com/author/ibireme/" title="发表人 ibireme" rel="author">ibireme</a> | 2015-10-23 | <a href="https://blog.ibireme.com/category/tec/ios-tec/" rel="category tag">iOS</a>, <a href="https://blog.ibireme.com/category/tec/" rel="category tag">技术</a></p><p class="none">iOS 开发中总会用到各种 JSON 模型转换库，这篇文章将会对常见的几个开源库进行一下评测。评测的内容主要集中在性能、功能、容错性这几个方面。</p>
<h2 class="none">评测的对象：</h2>
<p class="none"><span style="color: #ff6600;">Manually</span><br />
手动进行 JSON/Model 转换，不用任何开源库，可以进行高效、自由的转换，但手写代码非常繁琐，而且容易出错。</p>
<p class="none"><span style="color: #ff6600;">YYModel</span><br />
我造的一个新轮子，比较轻量（算上 .h 只有 5 个文件），支持自动的 JSON/Model 转换，支持定义映射过程。API 简洁，功能也比较简单。</p>
<p class="none"><span style="color: #ff6600;">FastEasyMapping</span><br />
Yalantis 开发的一个 JSON 模型转换库，可以自定义详细的 Model 映射过程，支持 CoreData。使用者较少。</p>
<p class="none"><span style="color: #ff6600;">JSONModel</span><br />
一个 JSON 模型转换库，有着比较简洁的接口。Model 需要继承自 JSONModel。</p>
<p class="none"><span style="color: #ff6600;">Mantle</span><br />
Github 官方团队开发的 JSON 模型转换库，Model 需要继承自 MTLModel。功能丰富，文档完善，使用广泛。</p>
<p class="none"><span style="color: #ff6600;">MJExtension</span><br />
国内开发者&#8221;小码哥&#8221;开发的 JSON 模型库，号称性能超过 JSONModel 和 Mantle，使用简单无侵入。国内有大量使用者。</p>
<p> <a href="https://blog.ibireme.com/2015/10/23/ios_model_framework_benchmark/#more-41804" class="more-link"><span aria-label="继续阅读iOS JSON 模型转换库评测">（更多&hellip;）</span></a></p>
				
					</article> <!-- .et_pb_post -->
			
					<article id="post-41787" class="et_pb_post post-41787 post type-post status-publish format-standard hentry category-ios-tec category-tec">

				
															<h2><a href="https://blog.ibireme.com/2015/10/23/daily/">最近一段时间的工作整理</a></h2>
					
					<p class="post-meta"> 由 <a href="https://blog.ibireme.com/author/ibireme/" title="发表人 ibireme" rel="author">ibireme</a> | 2015-10-23 | <a href="https://blog.ibireme.com/category/tec/ios-tec/" rel="category tag">iOS</a>, <a href="https://blog.ibireme.com/category/tec/" rel="category tag">技术</a></p><p class="p2"><span class="s1">正式转为全职 iOS 工程师已经有一年多了，这一年里工作并不忙，使得我有更多的时间和精力来研究些有意思的东西。最近整理了下这一年攒下来的代码，拆分成了几个库，在接下来的一段时间内会陆续开源：</span></p>
<p class="p2"><span class="s1"><a href="https://github.com/ibireme/YYModel" target="_blank">YYModel</a> 类似 Mantle/JSONModel 的工具，性能比 Mantle 高一个数量级，有更好的容错性，更简洁的 API。</span><br />
<span class="s1"><a href="https://github.com/ibireme/YYCache" target="_blank">YYCache</a> 类似 TMCache 那样的工具，有着更好的性能，支持 LRU，磁盘缓存支持 SQLite。</span><br />
<span class="s1"><a href="https://github.com/ibireme/YYImage" target="_blank">YYImage</a> iOS图像库，支持高性能的 APNG/WebP/GIF 动图播放、编码和解码，支持帧动画等。</span><br />
<span class="s1"><a href="https://github.com/ibireme/YYWebImage" target="_blank">YYWebImage</a> 类似 SDWebImage 的工具，基于 YYImage 和 YYCache，有更好的性能、更丰富的功能。</span><br />
<span class="s1"><span style="color: #ff6600;"><a href="https://github.com/ibireme/YYText" target="_blank">YYText</a></span> UILabel 和 UITextView 的开源实现，支持异步排版渲染、图文混排、更多文字特效/点击效果、动画/表情输入、竖排版等。</span></p>
<p class="p2"><span class="s1"><a href="https://github.com/ibireme/YYKeyboardManager" target="_blank">YYKeyboardManager</a> 从 YYText 分离出来的一个键盘监听工具，能实时监听和获取键盘视图、位置、动画。</span><br />
<span class="s1"><a href="https://github.com/ibireme/YYDispatchQueuePool" target="_blank">YYDispatchQueuePool</a> 从 YYText 分离出来的一个很简单的队列管理工具，用于管理全局并发任务。</span><br />
<span class="s1"><a href="https://github.com/ibireme/YYAsyncLayer" target="_blank">YYAsyncLayer</a> 从 YYText 分离出来的一个很简单的 CALayer 的子类，用于进行异步绘制和显示。</span><br />
<span class="s1"><a href="https://github.com/ibireme/YYCategories" target="_blank">YYCategories</a> Category 类型的工具库。</span></p>
<p class="p2"><span class="s1"><a href="https://github.com/ibireme/YYKit" target="_blank">YYKit</a> 上面所有工具的打包工具集，全部工具都兼容 iOS6~9。</span><br />
<span class="s1"><a href="https://github.com/ibireme/YYKit" target="_blank">YYKitDemo</a> YYKit 的功能/性能演示，实现有 Twitter 和 Weibo 的 Feed 列表、发布视图，有着和官方 App 完全一致的 UI 和更流畅的交互体验。</span></p>
<p class="p2"><span class="s1">每个库都会配有几篇博客来介绍相关技术、性能评测，这也算是我最近一年工作的总结吧。</span></p>
				
					</article> <!-- .et_pb_post -->
			
					<article id="post-41710" class="et_pb_post post-41710 post type-post status-publish format-standard hentry category-ios-tec category-tec">

				
															<h2><a href="https://blog.ibireme.com/2015/05/18/runloop/">深入理解RunLoop</a></h2>
					
					<p class="post-meta"> 由 <a href="https://blog.ibireme.com/author/ibireme/" title="发表人 ibireme" rel="author">ibireme</a> | 2015-05-18 | <a href="https://blog.ibireme.com/category/tec/ios-tec/" rel="category tag">iOS</a>, <a href="https://blog.ibireme.com/category/tec/" rel="category tag">技术</a></p><p>RunLoop 是 iOS 和 OSX 开发中非常基础的一个概念，这篇文章将从 CFRunLoop 的源码入手，介绍 RunLoop 的概念以及底层实现原理。之后会介绍一下在 iOS 中，苹果是如何利用 RunLoop 实现自动释放池、延迟回调、触摸事件、屏幕刷新等功能的。</p>
<p>Index<br />
<a href="#base">RunLoop 的概念</a><br />
<a href="#thread">RunLoop 与线程的关系</a><br />
<a href="#api">RunLoop 对外的接口</a><br />
<a href="#mode">RunLoop 的 Mode</a><br />
<a href="#inner">RunLoop 的内部逻辑</a><br />
<a href="#core">RunLoop 的底层实现</a><br />
<a href="#apple">苹果用 RunLoop 实现的功能</a><br />
<a style="padding-left: 30px;" href="#autorelease">AutoreleasePool</a><br />
<a style="padding-left: 30px;" href="#event">事件响应</a><br />
<a style="padding-left: 30px;" href="#gesture">手势识别</a><br />
<a style="padding-left: 30px;" href="#ui">界面更新</a><br />
<a style="padding-left: 30px;" href="#timer">定时器</a><br />
<a style="padding-left: 30px;" href="#perform">PerformSelecter</a><br />
<a style="padding-left: 30px;" href="#gce">关于GCD</a><br />
<a style="padding-left: 30px;" href="#network">关于网络请求</a><br />
<a href="#example">RunLoop 的实际应用举例</a><br />
<a style="padding-left: 30px;" href="#AFNetworking">AFNetworking</a><br />
<a style="padding-left: 30px;" href="#AsyncDisplayKit">AsyncDisplayKit</a></p>
<p> <a href="https://blog.ibireme.com/2015/05/18/runloop/#more-41710" class="more-link"><span aria-label="继续阅读深入理解RunLoop">（更多&hellip;）</span></a></p>
				
					</article> <!-- .et_pb_post -->
			<div class='wp-pagenavi'>
<span class='pages'>第 1 页，共 5 页</span><span class='current'>1</span><a class="page larger" title="第 2 页" href="https://blog.ibireme.com/page/2/">2</a><a class="page larger" title="第 3 页" href="https://blog.ibireme.com/page/3/">3</a><a class="page larger" title="第 4 页" href="https://blog.ibireme.com/page/4/">4</a><a class="page larger" title="第 5 页" href="https://blog.ibireme.com/page/5/">5</a><a class="nextpostslink" rel="next" href="https://blog.ibireme.com/page/2/">&raquo;</a>
</div>			</div> <!-- #left-area -->

				<div id="sidebar">
		<div id="aboutmewidget-5" class="et_pb_widget widget_aboutmewidget"><h4 class="widgettitle">关于</h4>		<div class="clearfix">
			<img src="" id="about-image" alt="" />
			伽蓝之堂——<br />一只魔法师的工坊		</div> <!-- end about me section -->
	</div> <!-- end .et_pb_widget --><div id="text-2" class="et_pb_widget widget_text"><h4 class="widgettitle">相关链接</h4>			<div class="textwidget"><ul>
<li><a href="http://github.com/ibireme/" target="_blank">Github</a></li>
<li><a href="http://weibo.com/ibireme" target="_blank">Weibo</a></li>
<li><a href="https://twitter.com/ibireme" target="_blank">Twitter</a></li>
<li><a href="https://www.linkedin.com/in/ibireme/" target="_blank">LinkedIn</a></li>
<li><a href="http://ibireme.deviantart.com/" target="_blank">DeviantART</a></li>
</ul>
</div>
		</div> <!-- end .et_pb_widget --><div id="meta-2" class="et_pb_widget widget_meta"><h4 class="widgettitle">功能</h4>			<ul>
						<li><a href="https://blog.ibireme.com/wp-login.php">登录</a></li>
			<li><a href="https://blog.ibireme.com/feed/">文章<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://blog.ibireme.com/comments/feed/">评论<abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://cn.wordpress.org/" title="基于WordPress，一个优美、先进的个人信息发布平台。">WordPress.org</a></li>			</ul>
			</div> <!-- end .et_pb_widget -->	</div> <!-- end #sidebar -->
		</div> <!-- #content-area -->
	</div> <!-- .container -->
</div> <!-- #main-content -->


			<footer id="main-footer">
				

		
				<div id="footer-bottom">
					<div class="container clearfix">
				
						<p id="copyright">
							Copyright 2018 ibireme
						</p>
					</div>	<!-- .container -->
				</div>
			</footer> <!-- #main-footer -->
		</div> <!-- #et-main-area -->


	</div> <!-- #page-container -->

	<!-- Baidu Analytics -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?6f3007d3fe15244980eff589f9d78063";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-43017647-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-43017647-1');
</script>
<!-- WP Audio player plugin v1.9.6 - https://www.tipsandtricks-hq.com/wordpress-audio-music-player-plugin-4556/ -->
    <script type="text/javascript">
        soundManager.useFlashBlock = true; // optional - if used, required flashblock.css
        soundManager.url = 'https://blog.ibireme.com/wp-content/plugins/compact-wp-audio-player/swf/soundmanager2.swf';
        function play_mp3(flg, ids, mp3url, volume, loops)
        {
            //Check the file URL parameter value
            var pieces = mp3url.split("|");
            if (pieces.length > 1) {//We have got an .ogg file too
                mp3file = pieces[0];
                oggfile = pieces[1];
                //set the file URL to be an array with the mp3 and ogg file
                mp3url = new Array(mp3file, oggfile);
            }

            soundManager.createSound({
                id: 'btnplay_' + ids,
                volume: volume,
                url: mp3url
            });

            if (flg == 'play') {
                    soundManager.play('btnplay_' + ids, {
                    onfinish: function() {
                        if (loops == 'true') {
                            loopSound('btnplay_' + ids);
                        }
                        else {
                            document.getElementById('btnplay_' + ids).style.display = 'inline';
                            document.getElementById('btnstop_' + ids).style.display = 'none';
                        }
                    }
                });
            }
            else if (flg == 'stop') {
    //soundManager.stop('btnplay_'+ids);
                soundManager.pause('btnplay_' + ids);
            }
        }
        function show_hide(flag, ids)
        {
            if (flag == 'play') {
                document.getElementById('btnplay_' + ids).style.display = 'none';
                document.getElementById('btnstop_' + ids).style.display = 'inline';
            }
            else if (flag == 'stop') {
                document.getElementById('btnplay_' + ids).style.display = 'inline';
                document.getElementById('btnstop_' + ids).style.display = 'none';
            }
        }
        function loopSound(soundID)
        {
            window.setTimeout(function() {
                soundManager.play(soundID, {onfinish: function() {
                        loopSound(soundID);
                    }});
            }, 1);
        }
        function stop_all_tracks()
        {
            soundManager.stopAll();
            var inputs = document.getElementsByTagName("input");
            for (var i = 0; i < inputs.length; i++) {
                if (inputs[i].id.indexOf("btnplay_") == 0) {
                    inputs[i].style.display = 'inline';//Toggle the play button
                }
                if (inputs[i].id.indexOf("btnstop_") == 0) {
                    inputs[i].style.display = 'none';//Hide the stop button
                }
            }
        }
    </script>
    <script type='text/javascript' src='https://blog.ibireme.com/wp-content/themes/Divi/includes/builder/scripts/frontend-builder-global-functions.js?ver=2.5.3'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/themes/Divi/js/custom.js?ver=2.5.3'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/themes/Divi/includes/builder/scripts/jquery.fitvids.js?ver=2.5.3'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/themes/Divi/includes/builder/scripts/waypoints.min.js?ver=2.5.3'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/themes/Divi/includes/builder/scripts/jquery.magnific-popup.js?ver=2.5.3'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var et_custom = {"ajaxurl":"https:\/\/blog.ibireme.com\/wp-admin\/admin-ajax.php","images_uri":"https:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/images","builder_images_uri":"https:\/\/blog.ibireme.com\/wp-content\/themes\/Divi\/includes\/builder\/images","et_load_nonce":"2dbc347abf","subscription_failed":"Please, check the fields below to make sure you entered the correct information.","fill":"Fill","field":"field","invalid":"Invalid email","captcha":"Captcha","prev":"Prev","previous":"\u4e0a\u4e00\u9875","next":"\u4e0b\u4e00\u9875","is_builder_plugin_used":""};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-content/themes/Divi/includes/builder/scripts/frontend-builder-scripts.js?ver=2.5.3'></script>
<script type='text/javascript' src='https://blog.ibireme.com/wp-includes/js/wp-embed.min.js?ver=4.8.7'></script>
</body>
</html>
